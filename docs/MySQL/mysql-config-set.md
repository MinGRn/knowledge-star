# å‰è¨€

`MySQL` ç¨‹åºå®‰è£…å±äºé»˜è®¤å®‰è£…ï¼Œå…¶ä¸­é…ç½®æ–‡ä»¶åœ¨ `windoes` ä¸‹çš„æ–‡ä»¶åä¸ºï¼š`my.ini`ã€‚

é…ç½®æ–‡ä»¶æ‰€å¤„ä½ç½®ï¼š

- **windows:** `C:\ProgramData\MySQL\MySQL Server ${version}\my.ini`

# å®Œæ•´é…ç½®æ–‡ä»¶

```ini
# ä»¥ä¸‹é€‰é¡¹ä¼šè¢«MySQLå®¢æˆ·ç«¯åº”ç”¨è¯»å–ã€‚
# æ³¨æ„åªæœ‰MySQLé™„å¸¦çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¿è¯å¯ä»¥è¯»å–è¿™æ®µå†…å®¹ã€‚
# å¦‚æœä½ æƒ³ä½ è‡ªå·±çš„MySQLåº”ç”¨ç¨‹åºè·å–è¿™äº›å€¼ã€‚
# éœ€è¦åœ¨MySQLå®¢æˆ·ç«¯åº“åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šè¿™äº›é€‰é¡¹ã€‚

# For advice on how to change settings please see
# http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html
# *** DO NOT EDIT THIS FILE. It's a template which will be copied to the
# *** default location during install, and will be replaced if you
# *** upgrade to a newer version of MySQL.

[client]

# pipe
# socket=0.0
port=3306

default-character-set=utf8

[mysql]
no-beep

default-character-set=utf8

# SERVER SECTION
# ----------------------------------------------------------------------
#
# The following options will be read by the MySQL Server. Make sure that
# you have installed the server correctly (see above) so it reads this 
# file.
#
# server_type=2
[mysqld]

# ä¸åœ¨ TCP/IP ç«¯å£ä¸Šè¿›è¡Œç›‘å¬.
# å¦‚æœæ‰€æœ‰çš„è¿›ç¨‹éƒ½æ˜¯åœ¨åŒä¸€å°æœåŠ¡å™¨è¿æ¥åˆ°æœ¬åœ°çš„ mysqld,
# è¿™æ ·è®¾ç½®å°†æ˜¯å¢å¼ºå®‰å…¨çš„æ–¹æ³•
# æ‰€æœ‰ mysqld çš„è¿æ¥éƒ½æ˜¯é€šè¿‡ Unix Sockets æˆ–è€…å‘½åç®¡é“è¿›è¡Œçš„.
# æ³¨æ„åœ¨ Windowsä¸‹å¦‚æœæ²¡æœ‰æ‰“å¼€å‘½åç®¡é“é€‰é¡¹è€Œåªæ˜¯ç”¨æ­¤é¡¹
# (é€šè¿‡ â€œenable-named-pipeâ€ é€‰é¡¹) å°†ä¼šå¯¼è‡´ MySQL æœåŠ¡æ²¡æœ‰ä»»ä½•ä½œç”¨!
# skip-networking

# enable-named-pipe

# shared-memory

# shared-memory-base-name=MYSQL

# The Pipe the MySQL Server will use
# socket=MYSQL

# The TCP/IP Port the MySQL Server will listen on
port=3306

# ä½¿ç”¨ç»™å®šç›®å½•ä½œä¸ºæ ¹ç›®å½•(å®‰è£…ç›®å½•)ã€‚
# basedir="C:/Program Files/MySQL/MySQL Server 5.6/"

# ä»ç»™å®šç›®å½•è¯»å–æ•°æ®åº“æ–‡ä»¶ã€‚
datadir=C:/ProgramData/MySQL/MySQL Server 5.6/Data

# é»˜è®¤ç¼–ç é›†è®¾ç½®ï¼Œå½“ä¸€ä¸ªä»»åŠ¡äº‹ä»¶æˆ–è€…æ•°æ®è¡¨è¢«åˆ›å»ºæ˜¯æ²¡æœ‰è¢«æŒ‡å®šç¼–ç é›†æ—¶åˆ™é‡‡ç”¨è¯¥ç¼–ç é›†
character-set-server=utf8

# The default storage engine that will be used when create new tables when
default-storage-engine=INNODB

# Set the SQL mode to strict
sql-mode="STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"

# General and Slow logging.
log-output=FILE
general-log=0
general_log_file="MINGRN.log"
slow-query-log=1
slow_query_log_file="MINGRN-slow.log"
long_query_time=10

# äºŒè¿›åˆ¶æ—¥å¿—
# log-bin

# é”™è¯¯æ—¥å¿—
log-error="MINGRN.err"

# Server Id.
server-id=1

# Secure File Priv.
secure-file-priv="C:/ProgramData/MySQL/MySQL Server 5.6/Uploads"

# The maximum amount of concurrent sessions the MySQL server will
# allow. One of these connections will be reserved for a user with
# SUPER privileges to allow the administrator to login even if the
# connection limit has been reached.
max_connections=151

# Query cache is used to cache SELECT results and later return them
# without actual executing the same query once again. Having the query
# cache enabled may result in significant speed improvements, if your
# have a lot of identical queries and rarely changing tables. See the
# "Qcache_lowmem_prunes" status variable to check if the current value
# is high enough for your load.
# Note: In case your tables change very often or if your queries are
# textually different every time, the query cache may result in a
# slowdown instead of a performance improvement.
query_cache_size=0

# The number of open tables for all threads. Increasing this value
# increases the number of file descriptors that mysqld requires.
# Therefore you have to make sure to set the amount of open files
# allowed to at least 4096 in the variable "open-files-limit" in
# section [mysqld_safe]
table_open_cache=2000

# Maximum size for internal (in-memory) temporary tables. If a table
# grows larger than this value, it is automatically converted to disk
# based table This limitation is for a single table. There can be many
# of them.
tmp_table_size=593M

# How many threads we should keep in a cache for reuse. When a client
# disconnects, the client's threads are put in the cache if there aren't
# more than thread_cache_size threads from before.  This greatly reduces
# the amount of thread creations needed if you have a lot of new
# connections. (Normally this doesn't give a notable performance
# improvement if you have a good thread implementation.)
thread_cache_size=10

#*** MyISAM Specific options
# The maximum size of the temporary file MySQL is allowed to use while
# recreating the index (during REPAIR, ALTER TABLE or LOAD DATA INFILE.
# If the file-size would be bigger than this, the index will be created
# through the key cache (which is slower).
myisam_max_sort_file_size=100G

# If the temporary file used for fast index creation would be bigger
# than using the key cache by the amount specified here, then prefer the
# key cache method.  This is mainly used to force long character keys in
# large tables to use the slower key cache method to create the index.
myisam_sort_buffer_size=2G

# Size of the Key Buffer, used to cache index blocks for MyISAM tables.
# Do not set it larger than 30% of your available memory, as some memory
# is also required by the OS to cache rows. Even if you're not using
# MyISAM tables, you should still set it to 8-64M as it will also be
# used for internal temporary disk tables.
key_buffer_size=8M

# Size of the buffer used for doing full table scans of MyISAM tables.
# Allocated per thread, if a full scan is needed.
read_buffer_size=64K
read_rnd_buffer_size=256K

#*** INNODB Specific options ***
# innodb_data_home_dir=0.0

# Use this option if you have a MySQL server with InnoDB support enabled
# but you do not plan to use it. This will save memory and disk space
# and speed up some things.
# skip-innodb

# Additional memory pool that is used by InnoDB to store metadata
# information.  If InnoDB requires more memory for this purpose it will
# start to allocate it from the OS.  As this is fast enough on most
# recent operating systems, you normally do not need to change this
# value. SHOW INNODB STATUS will display the current amount used.
innodb_additional_mem_pool_size=32M

# If set to 1, InnoDB will flush (fsync) the transaction logs to the
# disk at each commit, which offers full ACID behavior. If you are
# willing to compromise this safety, and you are running small
# transactions, you may set this to 0 or 2 to reduce disk I/O to the
# logs. Value 0 means that the log is only written to the log file and
# the log file flushed to disk approximately once per second. Value 2
# means the log is written to the log file at each commit, but the log
# file is only flushed to disk approximately once per second.
innodb_flush_log_at_trx_commit=1

# The size of the buffer InnoDB uses for buffering log data. As soon as
# it is full, InnoDB will have to flush it to disk. As it is flushed
# once per second anyway, it does not make sense to have it very large
# (even with long transactions).
innodb_log_buffer_size=16M

# InnoDB, unlike MyISAM, uses a buffer pool to cache both indexes and
# row data. The bigger you set this the less disk I/O is needed to
# access data in tables. On a dedicated database server you may set this
# parameter up to 80% of the machine physical memory size. Do not set it
# too large, though, because competition of the physical memory may
# cause paging in the operating system.  Note that on 32bit systems you
# might be limited to 2-3.5G of user level memory per process, so do not
# set it too high.
innodb_buffer_pool_size=5G

# Size of each log file in a log group. You should set the combined size
# of log files to about 25%-100% of your buffer pool size to avoid
# unneeded buffer pool flush activity on log file overwrite. However,
# note that a larger logfile size will increase the time needed for the
# recovery process.
innodb_log_file_size=48M

# Number of threads allowed inside the InnoDB kernel. The optimal value
# depends highly on the application, hardware as well as the OS
# scheduler properties. A too high value may lead to thread thrashing.
innodb_thread_concurrency=17

# The increment size (in MB) for extending the size of an auto-extend InnoDB system tablespace file when it becomes full.
innodb_autoextend_increment=64

# The number of regions that the InnoDB buffer pool is divided into.
# For systems with buffer pools in the multi-gigabyte range, dividing the buffer pool into separate instances can improve concurrency,
# by reducing contention as different threads read and write to cached pages.
innodb_buffer_pool_instances=8

# Determines the number of threads that can enter InnoDB concurrently.
innodb_concurrency_tickets=5000

# Specifies how long in milliseconds (ms) a block inserted into the old sublist must stay there after its first access before
# it can be moved to the new sublist.
innodb_old_blocks_time=1000

# It specifies the maximum number of .ibd files that MySQL can keep open at one time. The minimum value is 10.
innodb_open_files=300

# When this variable is enabled, InnoDB updates statistics during metadata statements.
innodb_stats_on_metadata=0

# When innodb_file_per_table is enabled (the default in 5.6.6 and higher), InnoDB stores the data and indexes for each newly created table
# in a separate .ibd file, rather than in the system tablespace.
innodb_file_per_table=1

# Use the following list of values: 0 for crc32, 1 for strict_crc32, 2 for innodb, 3 for strict_innodb, 4 for none, 5 for strict_none.
innodb_checksum_algorithm=0

# The number of outstanding connection requests MySQL can have.
# This option is useful when the main MySQL thread gets many connection requests in a very short time.
# It then takes some time (although very little) for the main thread to check the connection and start a new thread.
# The back_log value indicates how many requests can be stacked during this short time before MySQL momentarily
# stops answering new requests.
# You need to increase this only if you expect a large number of connections in a short period of time.
back_log=80

# If this is set to a nonzero value, all tables are closed every flush_time seconds to free up resources and
# synchronize unflushed data to disk.
# This option is best used only on systems with minimal resources.
flush_time=0

# The minimum size of the buffer that is used for plain index scans, range index scans, and joins that do not use
# indexes and thus perform full table scans.
join_buffer_size=256K

# The maximum size of one packet or any generated or intermediate string, or any parameter sent by the
# mysql_stmt_send_long_data() C API function.
max_allowed_packet=4M

# If more than this many successive connection requests from a host are interrupted without a successful connection,
# the server blocks that host from performing further connections.
max_connect_errors=100

# Changes the number of file descriptors available to mysqld.
# You should try increasing the value of this option if mysqld gives you the error "Too many open files".
open_files_limit=4161

# Set the query cache type. 0 for OFF, 1 for ON and 2 for DEMAND.
query_cache_type=0

# If you see many sort_merge_passes per second in SHOW GLOBAL STATUS output, you can consider increasing the
# sort_buffer_size value to speed up ORDER BY or GROUP BY operations that cannot be improved with query optimization
# or improved indexing.
sort_buffer_size=256K

# The number of table definitions (from .frm files) that can be stored in the definition cache.
# If you use a large number of tables, you can create a large table definition cache to speed up opening of tables.
# The table definition cache takes less space and does not use file descriptors, unlike the normal table cache.
# The minimum and default values are both 400.
table_definition_cache=1400

# Specify the maximum size of a row-based binary log event, in bytes.
# Rows are grouped into events smaller than this size if possible. The value should be a multiple of 256.
binlog_row_event_max_size=8K

# If the value of this variable is greater than 0, a replication slave synchronizes its master.info file to disk.
# (using fdatasync()) after every sync_master_info events.
sync_master_info=10000

# If the value of this variable is greater than 0, the MySQL server synchronizes its relay log to disk.
# (using fdatasync()) after every sync_relay_log writes to the relay log.
sync_relay_log=10000

# If the value of this variable is greater than 0, a replication slave synchronizes its relay-log.info file to disk.
# (using fdatasync()) after every sync_relay_log_info transactions.
sync_relay_log_info=10000

# Load mysql plugins at start."plugin_x ; plugin_y".
# plugin_load

# é»˜è®¤é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¯¥é…ç½®éœ€è¦è¿›è¡Œå¢åŠ è¯¥é…ç½®ã€‚
# å¦‚æœä¸å¢åŠ è¯¥é…ç½®ï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶åå°†ä¸ä¼šè‡ªåŠ¨è§¦å‘ã€‚è¯¥é…ç½®ç”¨äºå¼€å¯äº‹ä»¶ã€‚
event_scheduler=ON 
```


# ä¿®æ”¹æ•°æ®åº“ç¼–ç æ ¼å¼

åœ¨mysql 5.5 ä¹‹å‰ï¼ŒUTF-8ç¼–ç åªæ”¯æŒ1-3ä¸ªå­—èŠ‚ï¼Œæ”¯æŒBMPè¿™éƒ¨åˆ†çš„Unicodeç¼–ç åŒºã€‚

ä»MySQL 5.5å¼€å§‹ï¼Œå¯ä»¥æ”¯æŒ4ä¸ªå­—èŠ‚UTFç¼–ç  `utf8mb4` ï¼Œä¸€ä¸ªå­—ç¬¦èƒ½å¤Ÿæ”¯æŒæ›´å¤šçš„å­—ç¬¦é›†ï¼Œä¹Ÿèƒ½å¤Ÿæ”¯æŒæ›´å¤šè¡¨æƒ…ç¬¦å·ã€‚

:smile: è¡¨æƒ…ä¸ºå››ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åœ¨å­˜åœ¨ emoji çš„åœºæ™¯ä¸‹éœ€è¦éœ€è¦ä½¿ç”¨è¯¥ç¼–ç é›†ã€‚

utf8mb4å…¼å®¹utf8ï¼Œä¸”æ¯”utf8èƒ½è¡¨ç¤ºæ›´å¤šçš„å­—ç¬¦ï¼Œæ˜¯utf8å­—ç¬¦é›†çš„è¶…é›†ã€‚æ‰€ä»¥ç°åœ¨ä¸€äº›æ–°çš„ä¸šåŠ¡ï¼Œæ¯”å¦‚ ISO ç­‰ï¼Œä¼šå°† MySQL æ•°æ®åº“çš„å­—ç¬¦é›†è®¾ç½®ä¸º utf8mb4ã€‚

---

ç°åœ¨å°†ç¼–ç é›†è®¾ç½®ä¸º `utf8mb4`ï¼Œéœ€è¦ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼š

```
[client]
# æœåŠ¡ç«¯é»˜è®¤ç¼–ç æ ¼å¼ï¼Œé»˜è®¤ä¸º `utf-8`
default-character-set = utf8mb4

[mysql]
# é»˜è®¤å­—ç¬¦ç¼–ç ï¼Œé»˜è®¤ `utf-8`
default-character-set = utf8mb4

[mysqld]
# é»˜è®¤ç¼–ç é›†è®¾ç½®ï¼Œå½“ä¸€ä¸ªä»»åŠ¡äº‹ä»¶æˆ–è€…æ•°æ®è¡¨è¢«åˆ›å»ºæ˜¯æ²¡æœ‰è¢«æŒ‡å®šç¼–ç é›†æ—¶åˆ™é‡‡ç”¨è¯¥ç¼–ç é›†
character-set-server = utf8mb4
```

ä»¥ä¸Šä¿®æ”¹å®Œæˆåé‡å¯ `mysql` æœåŠ¡ï¼Œåœ¨ `MySQL Command Line Client` ä¸­è¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯æŸ¥çœ‹æ•°æ®åº“ç¼–ç é›†ï¼š

```mysql
SHOW VARIABLES LIKE 'character%';
```

è¾“å‡ºç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
+--------------------------+---------------------------------------------------------+
| Variable_name            | Value                                                   |
+--------------------------+---------------------------------------------------------+
| character_set_client     | utf8mb4                                                 |
| character_set_connection | utf8mb4                                                 |
| character_set_database   | utf8mb4                                                 |
| character_set_filesystem | binary                                                  |
| character_set_results    | utf8mb4                                                 |
| character_set_server     | utf8mb4                                                 |
| character_set_system     | utf8                                                    |
| character_sets_dir       | C:\Program Files\MySQL\MySQL Server 5.6\share\charsets\ |
+--------------------------+---------------------------------------------------------+
8 rows in set (0.00 sec)
```

å¯å³çœ‹åˆ°ç¼–ç æ ¼å¼è¢«ä¿®æ”¹ä¸º `utf8mb4`ã€‚

ç°åœ¨åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œè¿›è¡Œ emoji æ•°æ®æ’å…¥ï¼š

```sql
INSERT INTO `sys_role`(`id`, `role_name`, `role_type`, `status`, `deleted`, `sort`, `create_time`, `update_time`, `description`) 
VALUES ('62eedcd2f47e11e8881d5615b7fd4e65', 'Emojiæµ‹è¯•ğŸ˜€', '6888bc90f47e11e8881d5615b7fd4e65', 1, 1, 1, '2018-11-30 17:00:11', '2018-11-30 17:00:13', NULL);
```
```
mysql> select * from sys_role;
+----------------------------------+-----------------+----------------------------------+--------+---------+------+---------------------+---------------------+-------------+
| id                               | role_name       | role_type                        | status | deleted | sort | create_time         | update_time         | description |
+----------------------------------+-----------------+----------------------------------+--------+---------+------+---------------------+---------------------+-------------+
| 3a74e039f47e11e8881d5615b7fd4e65 | è¶…çº§ç®¡ç†å‘˜      | 48264450f47e11e8881d5615b7fd4e65 |      1 |       1 |    1 | 2018-11-30 17:00:11 | 2018-11-30 17:00:13 | NULL        |
| 62eedcd2f47e11e8881d5615b7fd4e65 | Emojiæµ‹è¯•ğŸ˜€       | 6888bc90f47e11e8881d5615b7fd4e65 |      1 |       1 |    1 | 2018-11-30 17:00:11 | 2018-11-30 17:00:13 | NULL        |
+----------------------------------+-----------------+----------------------------------+--------+---------+------+---------------------+---------------------+-------------+
2 rows in set (0.00 sec)
```

å¯ä»¥çœ‹åˆ°æ•°æ®è¢«æ­£å¸¸æ’å…¥ï¼Œå¦‚æœç¼–ç é›†è®¾ç½®ä¸º `utf-8` åœ¨æ’å…¥æ˜¯ä¼šæç¤ºå¼‚å¸¸ã€‚
